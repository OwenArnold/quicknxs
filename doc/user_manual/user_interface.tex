\chapter{User Interface}
\label{chap:user_interface}

\section{Overview}
\def\svgwidth{\textwidth}
\begin{LARGE}
\includegraphics[width=455pt]{screenshots/overview_labels.png} 
\end{LARGE}

In addition to the default elements of a typical graphical user interface (GUI) like menu-, tool- and statusbar the QuickNXS program has a central area, which can be switch using the tab bar above, and several "Dock Windows" on the left and right side, always visible. Most users will work only with the "Overview" tab visible in the image above as it contains all valuable information about the current loaded dataset and the reduction parameters. 
The "Dock Window" can be customized as described in the according section and hold parameter entries for the reduction as well as the projection and reflectivity plot, most important for the extraction.
The other tabs, shown below, allow a parallel view on the 2D maps of all channels in the active dataset as well as an preview of off-specular scattering and motor/controller logs from the current file.

 \begin{tabular}{cccc}
 \includegraphics[width=103pt]{screenshots/xymaps.png}&
 \includegraphics[width=103pt]{screenshots/xtofmaps.png}&
 \includegraphics[width=103pt]{screenshots/offspecmaps.png}&
 \includegraphics[width=103pt]{screenshots/daslogs.png}\\
  X-Y-Maps & X-ToF-Maps & Off-Specular & DAS Logs
 \end{tabular}

 Each of the plots has an own toolbar described in the plots section and show one specific aspect of your dataset. Often it is important to look not only on one of these plots to analyze the data, so it is good to familiarize with what you see there.
 All options available in the toolbar are duplicated somewhere in the menus, to make it easier to find, what you need.
 The most important actions have \textbf{keystrokes} assigned to them for convenience. 
 The keys have been chosen to be accessible only with the right hand, so you can use them together with the mouse.
 \textbf{Most GUI elements have a tool tip} assigned, so you can always position the \textbf{mouse cursor} over \textbf{any element to get a more detailed description}, what it is used for.


\section{Menu and toolbar actions}
  
  \begin{description}
   \item[{\icon{document-open} File -> Open... (CTRL+O)}] Shows a dialog to select a file to be loaded. The filename filter depends if "Histogram" or "Event" mode are selected in the Files Dock Window.
   \item[{\icon{listDown} File -> Next File (CTRL+D)}] Opens the file below the active selection in the Files Dock Window.
   \item[{\icon{listUp} File -> Previous File (CTRL+SHIFT+O)}] Opens the file above the active selection in the Files Dock Window.
   
   \item[{\icon{extractNormalization} Reduction -> Set Normalization (CTRL+W)}] Use the data extracted from the current file as a normalization dataset. You can add as many of these datasets as you like or remove them by activating this action again. The appropriate normalization file is selected using the number of time of flight channels in a file and the central wavelength, if this is ambiguous a dialog is shown to the user to select one dataset.
   \item[{\icon{clearNorm} Reduction -> Clear Normalization (CTRL+SHIFT+W)}] Use the data extracted from the current file as a normalization dataset. You can add as many of these datasets as you like or remove them by activating this action again. The appropriate normalization file is selected using the number of time of flight channels in a file and the central wavelength, if this is ambiguous a dialog is shown to the user to select one dataset.
   
   \item[{\icon{totalReflection} Reduction -> Set Scaling (CTRL+S)}] For the first dataset it tries to find the edge of total reflection and fit a constant to all points before it to normalize it to one. For the second dataset it fits a polynomial to the overlapping region of the active dataset and the closest one found in the reduction table to stitch them together. It is helpful to first define a suitable range of cut points to improve the results.
   \item[{\icon{addRef} Reduction -> Keep Item in List (CTRL+Q)}] Use the reflectivity from the current dataset and add it the the reduction list. Only works for already normalized dataset. The options in the reduction list can still be changed later.
   \item[{\icon{delRef} Reduction -> Remove Line}] Remove the selected line from the reduction list.
   \item[{\icon{clearRef} Reduction -> Clear List (CTRL+SHIFT+Q)}] Clear the full reduction list to start a new set of reflectivity.

    \item[{\icon{reduce} Reduction -> Reduce...}] Use the items and options in the reduction table to export a dataset. Shows a dialog to select how the export should be done.

   \item[{\icon{findXauto} Advanced -> Automatic Peak Finder}] If checked, the program runs a peak finder and peak fitting algorithm on the X-projection of the data each time a new dataset is loaded and sets the X-center parameter accordingly.
   \item[{\icon{limitYauto} Advanced -> Automatic Y Limits}] If checked, the program detects the region, where the intensity in the Y-projection drops below a certain threshold and sets the Y-center and Y-width parameters accordingly.
   \item[{\icon{fitXPos} Advanced -> Refine X}] If checked, each time the user clicks on the X-projection plot to select another X-center position, a Gaussian fit is executed to refine the position.
   \item[{\icon{tthZero} Advanced -> Adjust Direct Beam}] For datasets where the direct pixel and or DANGLE0 values are not correctly defined, this action can take the current X-position of a direct beam measurement to set overwrite parameters accordingly.
   \item[{ Advanced -> Clear Overwrite}] This clears the overwrite parameters defined with "Adjust Direct Beam".
  \end{description}

\section{The Overview Tab}
  This central tab shows information on the current dataset and the data reduction. A label at the top indicates the current file number, experiment ID, measurement type and the currently selected channel.
  The two map plots below the label show the projected intensities on the horizontal and vertical detector axes (left) and on the time of flight and horizontal detector axes (right), in the same way as it is show during data acquisition.
  In the center some important parameters, extracted from the datafile header, are displayed. The αi, 2Θ and Counts ROI parameter also depends on the selected X- and Y- region and is thus not directly read from the file.
  The mouse can be used to define the X- and Y-region in this plots similar as in the projection Dock Windows described below.
  
  At the bottom you can find the reduction table and an additional tab with a list of defined normalization datasets.
  These tables show the parameters used for the respective intensity extractions.
  These parameters in the Data tab can be edited afterwards and will be applied directly to the reflectivity curve shown in the Reflectivity Dock Window.
  Directly above the table is a label showing the numbers of all defined normalization files and a drop-down selection for the current dataset channel shown in the Overview, projections and reflectivity plots.
  Selecting a channel not present in the current file will result in a fallback to the first channel.
  
\section{Dock Windows}
  Dock windows are the the regions on the left and right of the window containing e.g. the projection plots and extraction parameters. They are visible on any tab of the main interface.
  These windows positions can be customized by the user anywhere around the center, on top of each other, detached from the main window or completely closed (will be saved on exit). Closed dock windows can be restored by right clicking any dock window title or the empty region next to the toolbar and menu. You can easily detach and reattach them by clicking the diamod button at the top right.
  Here is a list of available dock windows:
  
  \begin{description}
   \item[Files] A list of all datafile in the current directory together with an entry to search for a file by number and select to extract either histogram or event mode data.
   
   \item[X-Projection] A plot with the data of the loaded file projected on the detector X-axis. Green lines indicate the background region defined at the moment. The X-position is marked with a black line and the X-width with two red lines. The mouse can be used to change the background region and X-center using the left mouse button and set the X-width using the right mouse button.
   \item[Y-Projection] An equivalent projection on the detector Y-axis, showing the selected Y-region with red lines. The mouse can be used to change the Y-region using left clicks.
   
   \item[Reflectivity] Show all datasets already added to the reduction list and the currently selected one. For unnormalized datasets it show intensity and background vs. wavelength. Datasets in the reduction list can be scaled with the mouse wheel when at the right x-coordinates (faster scaling when CTRL is pressed while scrolling).
   
   \item[Reflectivity Extraction] The parameters used to extract the active reflectivity. When adding a dataset to the reduction list, these parameters are stored.
   \item[Plot Options] Global settings for the shown plots, does not effect the data reduction in any way. Here you can also chose to show the 2D datasets in wavelength and angle instead of time of flight and pixel.
   
   \item[Advanced Background] Additional parameters for the background subtraction, normally not in use.
   \item[Advanced Parameters] Settings to change the extraction method or overwrite parameters otherwise read from the datafile.
   \item[Algorithm Parameters] Settings for the peak finder and curve stitching algorithms.
   \item[Event Mode Readout] Define the binning to be used when reading event mode data.
  \end{description}

\section{Convenient Parameter Alteration with the Mouse Wheel}
  You can use the mouse wheel when you cursor is on top of a value entry to increase or decrease the according parameter. 
  This can be very convenient to see the result of e.g. changing the scaling factor for the current reflectivity. Holding down the CTRL key while scrolling increases the speed of the parameter changes.
  The same method can also be used to scale datasets in the reduction table, simply by moving the mouse at the curve in the reflectivity plot and scrolling with the mouse wheel.
  
\section{Plots}
  Each of the plots described above are created with the same framework and have a toolbar below them:\\
  \includegraphics[width=6cm]{screenshots/plottoolbar.png}\\
  The first 5 items allow the navigation on the plot, like zooming in and out or moving the current view position.
  The third icon from the left opens a dialog, which can be used to change the amount of freespace around the plot to fit the current window scaling.
  The last two icons can be used to save or print the plot.
  \textbf{Keep in mind that the X- and Y-projection as well as the overview maps can be used to select the extraction parameters.}
  This will only work when no scaling tool is selected from the plot toolbar.

\section{Data reduction table}
  \includegraphics[width=0.8\textwidth]{screenshots/reductiontable.png}

  Each entry created in the reduction table shows all important parameters needed for reflectivity extraction.
  In addition to the parameters found in the Reflectivity Extraction Dock Window there is a value for the direct pixel (DP) and detector arm position (TTH) as well as the dataset and normalization file number.
  \textbf{Changing any of the reduction parameters} (except for the two file number columns) immediately recalculates the extracted reflectivity.
  All lines present in the reduction table are plotted together with the current dataset in the Reflectivity Dock Window.

