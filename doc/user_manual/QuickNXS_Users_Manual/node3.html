<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Data Reduction</TITLE>
<META NAME="description" CONTENT="Data Reduction">
<META NAME="keywords" CONTENT="QuickNXS_Users_Manual">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="QuickNXS_Users_Manual.css">

<LINK REL="next" HREF="node4.html">
<LINK REL="previous" HREF="node2.html">
<LINK REL="up" HREF="QuickNXS_Users_Manual.html">
<LINK REL="next" HREF="node4.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html72"
  HREF="node4.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html70"
  HREF="QuickNXS_Users_Manual.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html64"
  HREF="node2.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/usr/share/latex2html/icons/prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html73"
  HREF="node4.html">Advanced Usage</A>
<B> Up:</B> <A NAME="tex2html71"
  HREF="QuickNXS_Users_Manual.html">QuickNXS_Users_Manual</A>
<B> Previous:</B> <A NAME="tex2html65"
  HREF="node2.html">User Interface</A>
<BR>
<BR></DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL CLASS="ChildLinks">
<LI><A NAME="tex2html74"
  HREF="node3.html#SECTION00310000000000000000">Open and view a dataset</A>
<LI><A NAME="tex2html75"
  HREF="node3.html#SECTION00320000000000000000">Go full-automatic: Reduction for dummies</A>
<LI><A NAME="tex2html76"
  HREF="node3.html#SECTION00330000000000000000">Quick start: Step-by-step standard reduction</A>
<UL>
<LI><A NAME="tex2html77"
  HREF="node3.html#SECTION00331000000000000000">Step 1: Set wavelength normalization from direct beam</A>
<LI><A NAME="tex2html78"
  HREF="node3.html#SECTION00332000000000000000">Step 2: Define a suitable background- and y-region</A>
<LI><A NAME="tex2html79"
  HREF="node3.html#SECTION00333000000000000000">Step 3: Normalize total reflection and add the first dataset</A>
<LI><A NAME="tex2html80"
  HREF="node3.html#SECTION00334000000000000000">Step 4: Add additional datasets and stitch them together</A>
<LI><A NAME="tex2html81"
  HREF="node3.html#SECTION00335000000000000000">Step 5: Refine the dataset scaling and cutting</A>
<LI><A NAME="tex2html82"
  HREF="node3.html#SECTION00336000000000000000">Step 6: Export your data</A>
</UL>
<BR>
<LI><A NAME="tex2html83"
  HREF="node3.html#SECTION00340000000000000000">Examples</A>
<LI><A NAME="tex2html84"
  HREF="node3.html#SECTION00350000000000000000">Common problems to be aware of</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION00300000000000000000"></A>
<A NAME="chap:data_reduction"></A>
<BR>
Data Reduction
</H1>

<P>

<H1><A NAME="SECTION00310000000000000000"></A>
<A NAME="sec:open_file"></A>
<BR>
Open and view a dataset
</H1>
  The easiest way to start with is to enter the number of a normalization dataset in the "Open Numbers:" entry of the Files Dock Window and press enter. The program will now locate the file and open it.
  The Files Dock Window list will be populated with all files in your current proposal data folder and the plot windows should look similar to this:

<P>
<TABLE CELLPADDING=3>
<TR><TD ALIGN="CENTER"><IMG
  WIDTH="215" HEIGHT="206" ALIGN="BOTTOM" BORDER="0"
 SRC="./normalizemap1.png"
 ALT="Image normalizemap1"></TD>
<TD ALIGN="CENTER"><IMG
  WIDTH="215" HEIGHT="205" ALIGN="BOTTOM" BORDER="0"
 SRC="./normalizemap2.png"
 ALT="Image normalizemap2"></TD>
<TD ALIGN="CENTER">&nbsp;</TD>
</TR>
<TR><TD ALIGN="CENTER">Overview X-Y</TD>
<TD ALIGN="CENTER">Overview ToF-X</TD>
<TD ALIGN="CENTER">&nbsp;</TD>
</TR>
<TR><TD ALIGN="CENTER"><IMG
  WIDTH="215" HEIGHT="146" ALIGN="BOTTOM" BORDER="0"
 SRC="./normalize1.png"
 ALT="Image normalize1"></TD>
<TD ALIGN="CENTER"><IMG
  WIDTH="215" HEIGHT="89" ALIGN="BOTTOM" BORDER="0"
 SRC="./normalize2.png"
 ALT="Image normalize2"></TD>
<TD ALIGN="CENTER"><IMG
  WIDTH="167" HEIGHT="178" ALIGN="BOTTOM" BORDER="0"
 SRC="./normalize3.png"
 ALT="Image normalize3"></TD>
</TR>
<TR><TD ALIGN="CENTER">X-Projection</TD>
<TD ALIGN="CENTER">Y-Projection</TD>
<TD ALIGN="CENTER">Reflectivity</TD>
</TR>
</TABLE>

<P>

<H1><A NAME="SECTION00320000000000000000">
Go full-automatic: Reduction for dummies</A>
</H1>
  For good quality data the program supports a fully automatized mode, where all reduction parameters are automatically calculated.
  This mode will be applied automatically when more than one dataset is selected at the File Open Dialog.
  The direct beam measurement have to have lower scan numbers than the actual measurements or need to be set in advance for this method to work.

<P>
The automatic algorithm performs the same steps as described in section <A HREF="#sec:quick_start">3.3</A>, while trying to guess the best parameters.
  The datasets are read one-by-one and, depending on the <SPAN CLASS="MATH"></SPAN>-angle, they are either set as normalization or reflectivity data in the reduction list.
  Here is an example how the interface might look after the algorithm has finished:

<P>
<IMG
  WIDTH="637" HEIGHT="503" ALIGN="BOTTOM" BORDER="0"
 SRC="./overview.png"
 ALT="Image overview">

<P>
You can now scale individual datasets as described in <A HREF="#sec:scaling">3.3.5</A>, if the stitching was not performed optimally.
  When satisfied with the result, you can save the data as described in the export section <A HREF="#sec:export">3.3.6</A>.

<P>

<H1><A NAME="SECTION00330000000000000000"></A>
<A NAME="sec:quick_start"></A>
<BR>
Quick start: Step-by-step standard reduction
</H1>
  For most datasets the reduction is done very similar to the fully automatized method but with more control of the user.
  Every dataset is examined by the operator to select the best extraction parameters.

<P>

<H2><A NAME="SECTION00331000000000000000">
Step 1: Set wavelength normalization from direct beam</A>
</H2>
    
<DIV ALIGN="CENTER">
r0.55
    <TABLE CELLPADDING=3 ALIGN="CENTER">
<TR><TD ALIGN="CENTER">Reflectivity before</TD>
<TD ALIGN="CENTER">Reflectivity after</TD>
</TR>
<TR><TD ALIGN="CENTER"><IMG
  WIDTH="160" HEIGHT="171" ALIGN="BOTTOM" BORDER="0"
 SRC="./normalize3.png"
 ALT="Image normalize3"></TD>
<TD ALIGN="CENTER"><IMG
  WIDTH="160" HEIGHT="171" ALIGN="BOTTOM" BORDER="0"
 SRC="./normalize_after.png"
 ALT="Image normalize_after"></TD>
</TR>
</TABLE>
</DIV>

<P>
<SPAN  CLASS="textbf">Open your normalization file</SPAN> as described in section <A HREF="#sec:open_file">3.1</A>. 
      Make sure the Î±i-calc value shown in the overview tab is close to zero the X- and Y-projections show the correct regions with the red indicators.
      Activate the <SPAN  CLASS="textbf">Set Normalization action</SPAN> <IMG
  WIDTH="16" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="./extractNormalization.png"
 ALT="Image extractNormalization"> will add the current dataset to the "Normalization" list, the "Normalizations:" label will show the number of the dataset and the reflectivity will show the normalized intensities, which should all be one.
      Repeat this step for each normalization file needed for your dataset.

<P>

<H2><A NAME="SECTION00332000000000000000">
Step 2: Define a suitable background- and y-region</A>
</H2>
    
<DIV ALIGN="CENTER">
r0.55
    <DIV ALIGN="CENTER">

</DIV>
X-projection with background region (green)
<BR>      <IMG
  WIDTH="222" HEIGHT="151" ALIGN="BOTTOM" BORDER="0"
 SRC="./background.png"
 ALT="Image background">
    <TABLE CELLPADDING=3 ALIGN="CENTER">
<TR><TD ALIGN="CENTER">Y-projection of small sample</TD>
<TD ALIGN="CENTER">X-Y map</TD>
</TR>
<TR><TD ALIGN="CENTER"><IMG
  WIDTH="222" HEIGHT="92" ALIGN="BOTTOM" BORDER="0"
 SRC="./yregion.png"
 ALT="Image yregion"></TD>
<TD ALIGN="CENTER"><IMG
  WIDTH="97" HEIGHT="93" ALIGN="BOTTOM" BORDER="0"
 SRC="./yregionmap.png"
 ALT="Image yregionmap"></TD>
</TR>
</TABLE>
</DIV>

<P>
Although it is in principle possible to define the extraction and background region for each dataset separately, it is recommended to use the same parameters for all files.
    From this perspective it is often a good idea to start with the dataset with the highest incident angle, as there the signal to background ration is the lowest.
    To produce the best results you should select a large region (statistics), keeping enough distance from the reflected beam (especially when off-specular Bragg-sheets are present) and to not include regions where the background drops (shadowed by the right detector slit for example).
    The Y-region, shown in the Y-projection of the first (low Q) dataset, is often detected very well automatically.
    Just check that it fits to the reflected intensity area. 
    For very small samples it can sometimes make sense to manually restrain the area to the sample reflection.

<P>

<H2><A NAME="SECTION00333000000000000000">
Step 3: Normalize total reflection and add the first dataset</A>
</H2>
    
<DIV ALIGN="CENTER">
r0.4
     <IMG
  WIDTH="229" HEIGHT="245" ALIGN="BOTTOM" BORDER="0"
 SRC="./totalreflection.png"
 ALT="Image totalreflection"> 
    
</DIV>
Go to your datasets starting at the lowest <SPAN CLASS="MATH"></SPAN> value, remove points from the low <SPAN CLASS="MATH"></SPAN> region, which are not reasonable (not always needed) with the <SPAN  CLASS="textbf">Cut Pts parameters</SPAN>:
    <IMG
  WIDTH="160" HEIGHT="17" ALIGN="BOTTOM" BORDER="0"
 SRC="./cutpoints.png"
 ALT="Image cutpoints"> Than activate the <SPAN  CLASS="textbf">Set Scaling action</SPAN> <IMG
  WIDTH="16" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="./totalReflection.png"
 ALT="Image totalReflection"> to normalize the total reflection to one.
    This should now look like the image on the right.
    Next add the dataset to the refinement list using the <SPAN  CLASS="textbf">Keep Item in List action</SPAN> <IMG
  WIDTH="16" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="./addRef.png"
 ALT="Image addRef"> to add the dataset with the current parameters in the list.
    This will automatically switch off the <SPAN  CLASS="textbf">Automatic Y Limits</SPAN> <IMG
  WIDTH="16" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="./limitYauto.png"
 ALT="Image limitYauto">, so all datasets will be reduced with the same Y-range.
    This is important for the high <SPAN CLASS="MATH"></SPAN> region as the background often inhibits a good automatic detection of the Y-region.

<P>

<H2><A NAME="SECTION00334000000000000000">
Step 4: Add additional datasets and stitch them together</A>
</H2>
    
<DIV ALIGN="CENTER">
r0.3
    <DIV ALIGN="CENTER">

</DIV>     <IMG
  WIDTH="191" HEIGHT="205" ALIGN="BOTTOM" BORDER="0"
 SRC="./stitching1.png"
 ALT="Image stitching1"> 
    
</DIV>
Now you can continue adding each subsequent dataset one after another.
    If nothing goes wrong, the only thing that needs to be changed from dataset are the <SPAN  CLASS="textbf">Cut Pts</SPAN> and <SPAN  CLASS="textbf">Scaling</SPAN> values.
    If the scaling of subsequent datasets does not fit, activate the <SPAN  CLASS="textbf">Set Scaling action</SPAN> <IMG
  WIDTH="16" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="./totalReflection.png"
 ALT="Image totalReflection"> again. 
    This fits a parabola to the logarithmic data of both adjacent datasets including a scaling factor for the second, which is than used for the scaling after the fit.
    The error weighted <SPAN CLASS="MATH"></SPAN> used for this refinement is:
    <BR>
<DIV ALIGN="CENTER" CLASS="mathdisplay">
<!-- MATH
 \begin{eqnarray*}
\chi_{stitch}^2 =& \underset{DS1}{\sum} \frac{(\log(I_i)-p(Q_i))^2}{(\delta{}I_i/I_i)^2} + \underset{DS2}{\sum} \frac{(\log(I_j\cdot scale)-p(Q_j))^2}{(\delta{}I_j/I_j)^2} \\
      \text{with } p(Q) =& a\cdot Q^2 + b\cdot Q +c
\end{eqnarray*}
 -->
<TABLE CELLPADDING="0" ALIGN="CENTER" WIDTH="100%">
<TR VALIGN="MIDDLE"><TD></TD>
<TD>&nbsp;</TD>
<TD></TD>
<TD CLASS="eqno" WIDTH=10 ALIGN="RIGHT">
&nbsp;</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP WIDTH="50%" ALIGN="RIGHT">with&nbsp;</TD>
<TD>&nbsp;</TD>
<TD></TD>
<TD CLASS="eqno" WIDTH=10 ALIGN="RIGHT">
&nbsp;</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL">

    The resulting fit function is shown in the reflectivity plot together with the scaled data as can be seen in the two figures on the right..
    For some datasets with very sharp features like multilayer Bragg-peaks this method will not work, in those cases you need to change the <SPAN  CLASS="textbf">Scale 10^</SPAN> parameter manually until the datasets fit together nicely.
    For polarized measurements it can sometimes be helpful to switch back and forth between different polarization channels as the variation in contrast can lead to smooth transitions, where the other channel has a sharp feature.
    Now add the dataset to the reduction list with <SPAN  CLASS="textbf">Keep Item in List action</SPAN> <IMG
  WIDTH="16" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="./addRef.png"
 ALT="Image addRef"> again and repeat the procedure for all datasets of belonging to this measurement.

<P>

<H2><A NAME="SECTION00335000000000000000"></A>
  <A NAME="sec:scaling"></A>
<BR>
Step 5: Refine the dataset scaling and cutting
</H2>
    
<DIV ALIGN="CENTER">
r0.6
    <DIV ALIGN="CENTER">

</DIV>    <TABLE CELLPADDING=3 ALIGN="CENTER">
<TR><TD ALIGN="CENTER">As added to reduction list</TD>
<TD ALIGN="CENTER">With changed cut points</TD>
</TR>
<TR><TD ALIGN="CENTER"><IMG
  WIDTH="179" HEIGHT="192" ALIGN="BOTTOM" BORDER="0"
 SRC="./stitching2.png"
 ALT="Image stitching2"></TD>
<TD ALIGN="CENTER"><IMG
  WIDTH="179" HEIGHT="192" ALIGN="BOTTOM" BORDER="0"
 SRC="./cleanpoints.png"
 ALT="Image cleanpoints"></TD>
</TR>
</TABLE>
</DIV>
When all datasets of one measurement have been added, as can be seen in the image on the right, you can try to improve the scaling of the different parts, if needed, and change the cutting parameters.
    To change the scaling of one dataset you can either change the value of the <SPAN  CLASS="textbf">I0 column</SPAN> entry in the reduction list or move the mouse <SPAN  CLASS="textbf">cursor on top of the curve</SPAN> you want to scale and <SPAN  CLASS="textbf">move the mouse wheel</SPAN>.
    To remove unwanted point you need to change the values of the <SPAN  CLASS="textbf">P0</SPAN> and <SPAN  CLASS="textbf">PN column</SPAN> entries as they define the number of points cut from the low- and hight-Q side respectively.
    If the number of time of flight channels in the histogram dataset is larger than the wavelength window used for the measurement it is possible that large values are needed (&lt;=60) to see changes in the dataset.

<P>

<H2><A NAME="SECTION00336000000000000000"></A>
  <A NAME="sec:export"></A>
<BR>
Step 6: Export your data
</H2>
    
<DIV ALIGN="CENTER">
r0.4
    <DIV ALIGN="CENTER">

</DIV>     <IMG
  WIDTH="243" HEIGHT="256" ALIGN="BOTTOM" BORDER="0"
 SRC="./reduced.png"
 ALT="Image reduced">
    
</DIV>
Now you are ready to export you reflectivity! 
    Activate the <SPAN  CLASS="textbf">Reduce... action</SPAN> <IMG
  WIDTH="16" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="./reduce.png"
 ALT="Image reduce"> from the menu, toolbar or the button below the reduction list.
    The reduce dialog as several options for the export of the dataset.
    You can select which reductions should be stored, choose the channels to export and define which data formats should be created.
    As a default, the specular reflectivity of all available channels will be exported to separate ASCII files and a dialog with a plot of the resulting data will be shown afterwards.
    Additional output options are a combined ASCII file containing all channels, a matlab or numpy datafile for later processing, a Gnuplot script and image file to plot the ASCII data and a GenX reflectivity modeling template already containing the measured data.

<P>

<H1><A NAME="SECTION00340000000000000000">
Examples</A>
</H1>
  This section will give three example datasets, which you can use to try the reduction yourself and compare the result with the images in this manual.

<P>

<H1><A NAME="SECTION00350000000000000000">
Common problems to be aware of</A>
</H1>
  
<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html72"
  HREF="node4.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html70"
  HREF="QuickNXS_Users_Manual.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html64"
  HREF="node2.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/usr/share/latex2html/icons/prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html73"
  HREF="node4.html">Advanced Usage</A>
<B> Up:</B> <A NAME="tex2html71"
  HREF="QuickNXS_Users_Manual.html">QuickNXS_Users_Manual</A>
<B> Previous:</B> <A NAME="tex2html65"
  HREF="node2.html">User Interface</A></DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Artur Glavic
2013-02-05
</ADDRESS>
</BODY>
</HTML>
